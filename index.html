<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Pail - A Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>    
    <script src="javascript/plupload.full.min.js"></script>
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Using Pail</h1>
      <h2 class="project-tagline" style='padding-left:10%;padding-right:10%;'>A simple example of how pail can be used with custom event binding.</h2>
      <a href="https://github.com/eddiej/pail" class="btn">View on GitHub</a>
      <a href="https://github.com/eddiej/pail/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/eddiej/pail/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      
<h2>The Uploader</h2>
<p>The uploader had been configured to enable .jpg and .jpeg files only with a maximum filesize of 100KB. Because this is a simple html demo (the policy and signature used must be generated on the fly from a backend), the uploader will return a HTTP error. </p>





<div id='uploadcontainer' style='border:1px solid #ddd; padding:20px; border-radius:3px'>
 <h3 style='color:#555'>Select A File</h3>
 <div id='uploadfile'> 
   <div class="progress"></div>
 </div>
 <button type="button" class="bttn bttn-default bttn-sm" id="selectfile">Select File</button>
 <button type="button" class="bttn bttn-danger bttn-sm disabled" id="resetupload">Reset</button>
 <p id='info' style='margin-top:20px;font-size:0.875em; color:#555'>
 </p>
</div>


<script>
//<![CDATA[
       
       uploader = new plupload.Uploader({
           browse_button : 'selectfile',
           container : 'uploadcontainer',
           runtimes : 'html5',
           url : 'https://s3.amazonaws.com/test.exsibit.com/',
           max_file_size : '100kb',
           multipart: true,
           multipart_params: {
             'key': 'my_special_place/${filename}',
             'Filename': '${filename}', // adding this to keep consistency across the runtimes
             'acl': 'public-read',
             'Content-Type': 'image/',
             'success_action_status': '201',
             'AWSAccessKeyId' : 'AKIAJLAP2IO6UP7FLWWA',
             'policy': 'eydleHBpcmF0aW9uJzogJzIwMTUtMDctMTRUMjA6NTY6MzFaJywKICAgICAgICAgICdjb25kaXRpb25zJzogWwogICAgICAgICAgICB7J2J1Y2tldCc6ICd0ZXN0LmV4c2liaXQuY29tJ30sCiAgICAgICAgICAgIHsnYWNsJzogJ3B1YmxpYy1yZWFkJ30sCiAgICAgICAgICAgIHsnc3VjY2Vzc19hY3Rpb25fc3RhdHVzJzogJzIwMSd9LAogICAgICAgICAgICBbJ2NvbnRlbnQtbGVuZ3RoLXJhbmdlJywgMCwgMTAyNTBdLAogICAgICAgICAgICBbJ3N0YXJ0cy13aXRoJywgJyRrZXknLCAnJ10sCiAgICAgICAgICAgIFsnc3RhcnRzLXdpdGgnLCAnJENvbnRlbnQtVHlwZScsICcnXSwKICAgICAgICAgICAgWydzdGFydHMtd2l0aCcsICckbmFtZScsICcnXSwKICAgICAgICAgICAgWydzdGFydHMtd2l0aCcsICckRmlsZW5hbWUnLCAnJ10KICAgICAgICAgIF0KICAgICAgICB9',
             'signature': 'nZ5KJNL7cCNRY3bweNwB4v75/ig='
           },
           // optional, but better be specified directly
           file_data_name: 'file',
           // re-use widget (not related to S3, but to Plupload UI Widget)
           multiple_queues: true,
           // Specify what files to browse for
           filters : [
         {title : 'Jpg Files', extensions : 'jpg,jpeg'}
       ],
           // Flash settings
           flash_swf_url : '/assets/plupload/Moxie.swf',
           // Silverlight settings
           silverlight_xap_url : '/assets/plupload/Moxie.xap',
         });

        placeholder = $('#uploadfile').children().first();
        uploader.init() 
        var queueMaxima = 1;

        // 1. Files Added          
        uploader.bind('FilesAdded', function(up, files) {           
          $.each(files, function(i, file) {
            $('#uploadfile').empty().append('               <div id="' + file.id + '" class="progress">                 <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="'+file.percent+'" aria-valuemin="0" aria-valuemax="100">                   <span class="file-info">' + file.name + ' (' + plupload.formatSize(file.size) + ')</span>' +
                '</div>               </div>');
          });
          $('#resetupload').removeClass('disabled')


            
          if(uploader.files.length > queueMaxima){
            while(uploader.files.length > queueMaxima){
              if(uploader.files.length > queueMaxima){
                x = uploader.files[queueMaxima-1]
                
                $('#'+x.id).remove();
                uploader.removeFile(uploader.files[queueMaxima-1]);
                uploader.stop()
              }
            }
            if(typeof(plupload_hook_removedExcessFromQueue) == "function"){plupload_hook_removedExcessFromQueue()}
          }
          up.start();
          up.refresh(); // Reposition Flash/Silverlight
        });

        // 2. Right before Upload Starts
        uploader.bind('BeforeUpload', function(up, file) {
          $('#' + file.id + " .progress-bar")
            .addClass('active')
        });

        // 2. Upload Progresses
        uploader.bind('UploadProgress', function(up, file) {
          $('#' + file.id + " .progress-bar")
            .width(file.percent + "%")
            .html('<span class="file-info">' + file.name + ' (' + plupload.formatSize(file.size) + ') ' + file.percent + "%</span>");
        });

        // 3. Error Occurs
        uploader.bind('Error', function(up, err) {  
          if($('.file-info').length > 0){
            error_element = $('.file-info')
          }
          else{
            error_element = $('.progress')
          }
          error_element.html("Error: " + err.code + ", " + err.message + (err.file ? " File: " + err.file.name : ""));
          $('#' + err.file.id + " .progress-bar")
            .addClass('progress-bar-danger')
            .removeClass('active')
        });

        // 4. File is Uploaded
        uploader.bind('FileUploaded', function(up, file) {
          $('#' + file.id + " .progress-bar")
            .addClass('progress-bar-success')
            .removeClass('active')
        });

        // 5. Stop button is clicked.
        $('#uploadcontainer').on('click', '#resetupload', function(){
          uploader.stop();
          $('#uploadfile').html(placeholder);
          $('#resetupload').addClass('disabled')
          $('#' + file.id + " .progress-bar")
            .removeClass('active')
          uploader.refresh(); // Reposition Flash/Silverlight
        });

        window.uploader = uploader;

//]]>
</script>

<script>
  window.uploader.bind('FileUploaded', function(up, file, info) { 
    var location = $($.parseXML(info.response)).find('Location').text()
    $('#uploadcontainer').find('#info').html('Woot! Your file has been uploaded to <a href="' + location + '">'+ unescape(location) +'</a>.')
  })

  window.uploader.unbind('Error')
  window.uploader.bind('Error', function(up, err) {
    $('#uploadcontainer').find('#info').html("Oops! Attempting to upload <strong>" + err.file.name + "</strong> resulted in a " + err.message);
    $('#' + err.file.id + " .progress-bar")
            .addClass('progress-bar-danger')
            .removeClass('active')
    console.info(err)
  });
</script>

<h2>The Code</h2>
<p>The uploader above would be generated from your a Rails view using the following code:</p>
<code>
&lt;div&nbsp;id='uploadcontainer'&gt;
<br>&nbsp;&lt;h3&gt;Select&nbsp;A&nbsp;File&lt;/h3&gt;
<br>&nbsp;&lt;div&nbsp;id='uploadfile'&gt;&nbsp;
<br>&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;progress&quot;&gt;&lt;/div&gt;
<br>&nbsp;&lt;/div&gt;
<br>&nbsp;&lt;button&nbsp;type=&quot;button&quot;&nbsp;class=&quot;btn&nbsp;btn-default&nbsp;btn&nbsp;btn-sm&quot;&nbsp;id=&quot;selectfile&quot;&gt;Select&nbsp;File&lt;/button&gt;
<br>&nbsp;&lt;button&nbsp;type=&quot;button&quot;&nbsp;class=&quot;btn&nbsp;btn-danger&nbsp;btn&nbsp;btn-sm&nbsp;disabled&quot;&nbsp;id=&quot;resetupload&quot;&gt;Reset&lt;/button&gt;
<br>&nbsp;&lt;p&nbsp;id='info'&nbsp;style='margin-top:20px;'&gt;
<br>&nbsp;&lt;/p&gt;
<br>&lt;/div&gt;

<br /><br />
&lt;%= pail({key: 'my_special_place', max_filesize: 102400, filter_title: 'Jpg Files', filter_extensions: 'jpg,jpeg'}) %&gt;
<br /><br />

&lt;script&gt;
<br>&nbsp;&nbsp;window.uploader.bind('FileUploaded',&nbsp;function(up,&nbsp;file,&nbsp;info)&nbsp;{&nbsp;
<br>&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;location&nbsp;=&nbsp;$($.parseXML(info.response)).find('Location').text()
<br>&nbsp;&nbsp;&nbsp;&nbsp;$('#uploadcontainer').find('#info').html('Woot!&nbsp;Your&nbsp;file&nbsp;has&nbsp;been&nbsp;uploaded&nbsp;to&nbsp;&lt;a&nbsp;href=&quot;'&nbsp;+&nbsp;location&nbsp;+&nbsp;'&quot;&gt;'+&nbsp;unescape(location)&nbsp;+'&lt;/a&gt;.')
<br>&nbsp;&nbsp;})
<br>
<br>&nbsp;&nbsp;window.uploader.unbind('Error')
<br>&nbsp;&nbsp;window.uploader.bind('Error',&nbsp;function(up,&nbsp;err)&nbsp;{
<br>&nbsp;&nbsp;&nbsp;&nbsp;$('#uploadcontainer').find('#info').html(&quot;Oops!&nbsp;Attempting&nbsp;to&nbsp;upload&nbsp;&lt;strong&gt;&quot;&nbsp;+&nbsp;err.file.name&nbsp;+&nbsp;&quot;&lt;/strong&gt;&nbsp;resulted&nbsp;in&nbsp;a&nbsp;&quot;&nbsp;+&nbsp;err.message);
<br>&nbsp;&nbsp;});
<br>&lt;/script&gt;
</code>





      <footer class="site-footer">
        <span class="site-footer-owner">The <a href="https://github.com/eddiej/pail">Pail</a> gem is maintained by <a href="https://github.com/eddiej">eddiej</a>.</span>
        <span class="site-footer-credits">This page's style is based on the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

